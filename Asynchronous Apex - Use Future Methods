Code 1 :- AccountProcessor




public with sharing class AccountProcessor {

    @future
    public static void countContacts(List<Id> accountIds) {
        // Query Accounts
        List<Account> accounts = [SELECT Id, Name FROM Account WHERE Id IN :accountIds];
        List<Account> updatedAccounts = new List<Account>();

        for (Account acc : accounts) {
            // Get number of contacts for this Account
            Integer contactCount = [SELECT count() FROM Contact WHERE AccountId = :acc.Id];
            acc.Number_of_Contacts__c = contactCount;
            updatedAccounts.add(acc);
        }

        // Update Accounts with the contact count
        update updatedAccounts;
    }
}


//////////////////////////////////////////////////////////////////////////////////////////////////////



Code 2 :- AccountProcessorTest


@isTest
private class AccountProcessorTest {
    @isTest
    static void testNoOfContacts() {
        // Create an Account
        Account acc = new Account(Name = 'Test Account');
        insert acc;

        // Add 2 contacts to the Account
        Contact c1 = new Contact(FirstName = 'Bob', LastName = 'Willie', AccountId = acc.Id);
        Contact c2 = new Contact(FirstName = 'Tom', LastName = 'Cruise', AccountId = acc.Id);
        insert new List<Contact>{c1, c2};

        List<Id> accountIds = new List<Id>{acc.Id};

        // Run the @future method
        Test.startTest();
        AccountProcessor.countContacts(accountIds);
        Test.stopTest();

        // Fetch the updated Account
        Account updatedAcc = [SELECT Number_of_Contacts__c FROM Account WHERE Id = :acc.Id];

        // Validate that contact count was updated correctly
        System.assertEquals(2, updatedAcc.Number_of_Contacts__c);
    }
}
